<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Bagheera by mozilla-metrics</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Bagheera</h1>
        <p>A REST API for Mozilla Metrics services.</p>

        <p class="view"><a href="https://github.com/mozilla-metrics/bagheera">View the Project on GitHub <small>mozilla-metrics/bagheera</small></a></p>


        <ul>
          <li><a href="https://github.com/mozilla-metrics/bagheera/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/mozilla-metrics/bagheera/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/mozilla-metrics/bagheera">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>Bagheera</h1>

<p>Version: 0.7-SNAPSHOT  </p>

<h4>REST service for Mozilla Metrics. This service currently uses Apache Kafka as its backing data store, then provides a few implementations of Kafka consumers to pull and persist to various data sinks.</h4>

<h3>Version Compatability</h3>

<p>This code is built with the following assumptions.  You may get mixed results if you deviate from these versions.</p>

<ul>
<li>
<a href="http://incubator.apache.org/kafka">Kafka</a> 0.7.1+</li>
<li>
<a href="https://developers.google.com/protocol-buffers">Protocol Buffers</a> 2.3.0+</li>
<li>
<a href="http://hadoop.apache.org">Hadoop</a> 0.20.2+</li>
<li>
<a href="http://hbase.apache.org">HBase</a> 0.90+</li>
</ul><h3>Prerequisites</h3>

<ul>
<li>Protocol Buffers</li>
<li>Zookeeper (for Kafka)</li>
<li>Kafka</li>
<li>Hadoop (if using HDFS based consumer)</li>
<li>HBase (if using HBase based consumer)</li>
</ul><h3>Building</h3>

<p>To make a jar you can do:  </p>

<p><code>mvn package</code></p>

<p>The jar file is then located under <code>target</code>.</p>

<h3>Running an instance</h3>

<p><strong>Make sure your Kafka and Zookeeper servers are running first (see Kafka documentation)</strong></p>

<p>In order to run bagheera on another machine you will probably want to use the <em>dist</em> assembly like so:</p>

<p><code>mvn assembly:assembly</code></p>

<p>The zip file now under the <code>target</code> directory should be deployed to <code>BAGHEERA_HOME</code> on the remote server.</p>

<p>To run Bagheera you can use <code>bin/bagheera</code> or copy the init.d script by the same name from <code>bin/init.d</code> to <code>/etc/init.d</code>. The init script assumes an installation of bagheera at <code>/usr/lib/bagheera</code>, but this can be modified by changing the <code>BAGHEERA_HOME</code> variable near the top of that script. Here is an example of using the regular bagheera script:</p>

<p><code>bin/bagheera 8080</code></p>

<h3>REST Request Format</h3>

<h5>URI <em>/submit/namespace/id</em>
</h5>

<p>POST/PUT </p>

<ul>
<li>The <em>namespace</em> is required and is only accepted if it is in the configured white-list.</li>
<li>The <em>id</em> is optional although if you provide it currently it needs to be a valid UUID unless id validation is disabled on the <em>namespace</em>. </li>
<li>The payload content length must be less than the configured maximum.</li>
</ul><p>DELETE</p>

<ul>
<li>The <em>namespace</em> is required and is only accepted if it is in the configured white-list.</li>
<li>The <em>id</em> is required although if you provide it currently it needs to be a valid UUID unless id validation is disabled on the <em>namespace</em>.</li>
</ul><p>Here's the list of HTTP response codes that Bagheera could send back:</p>

<ul>
<li>201 Created - Returns the id submitted/generated. (default)</li>
<li>403 Forbidden - Violated access restrictions. Most likely because of the method used.</li>
<li>413 Request Too Large - Request payload was larger than the configured maximum.</li>
<li>400 Bad Request - Returned if the POST/PUT failed validation in some manner.</li>
<li>404 Not Found - Returned if the URI path doesn't exist or if the URI was not in the proper format.</li>
<li>500 Server Error - General server error. Someone with access should look at the logs for more details.</li>
</ul><h3>Example Bagheera Configuration (conf/bagheera.properties)</h3>

<pre><code># valid namespaces (whitelist only, comma separated)
valid.namespaces=mynamespace,othernamespace
max.content.length=1048576
</code></pre>

<h3>Example Kafka Producer Configuration (conf/kafka.producer.properties)</h3>

<pre><code># comma delimited list of ZK servers
zk.connect=127.0.0.1:2181
# use bagheera message encoder
serializer.class=com.mozilla.bagheera.serializer.BagheeraEncoder
# asynchronous producer
producer.type=async
# compression.code (0=uncompressed,1=gzip,2=snappy)
compression.codec=2
# batch size (one of many knobs to turn in kafka depending on expected data size and request rate)
batch.size=100
</code></pre>

<h3>Example Kafka Consumer Configuration (conf/kafka.consumer.properties)</h3>

<pre><code># kafka consumer properties
zk.connect=127.0.0.1:2181
fetch.size=1048576
#serializer.class=com.mozilla.bagheera.serializer.BagheeraDecoder
# bagheera specific kafka consumer properties
consumer.threads=2
</code></pre>

<h3>Notes on consumers</h3>

<p>We currently use the consumers implemented here, but it may also be of interest to look at systems such as <a href="https://github.com/nathanmarz/storm">Storm</a> to process the messages. Storm contains a Kafka spout (consumer) and there are at least a couple of HBase bolts (processing/sink) already out there.</p>

<h3>License</h3>

<p>All aspects of this software are distributed under Apache Software License 2.0. See LICENSE file for full license text.</p>

<h3>Contributors</h3>

<ul>
<li>Xavier Stevens (<a href="http://twitter.com/xstevens">@xstevens</a>)</li>
<li>Daniel Einspanjer (<a href="http://twitter.com/deinspanjer">@deinspanjer</a>)</li>
<li>Anurag Phadke (<a href="http://twitter.com/anuragphadke">@anuragphadke</a>)</li>
<li>Mark Reid (<a href="http://twitter.com/reid_write">@reid_write</a>)</li>
</ul>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/mozilla-metrics">mozilla-metrics</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>